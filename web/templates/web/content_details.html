{% extends "base.html" %}

{% block content %}

{% load my_filters %}
{% load vote_filters %}

<h2>{{ content_object.title }} {{content_object.id}} Details<a href="{% url 'submit_content' content_object.id %}"><button class="btn" id="edit-content" style="float:right;">edit</button></a></h2>
<h4>Compiled by {{ content_object.owner }}</h4>
<br >
<div class="tabbable">
	<ul class="nav nav-tabs">
		<li class="active"><a href="#tab1" data-toggle="tab">Description</a></li>
		<li><a href="#tab2" data-toggle="tab">Youtube links</a></li>
		<li><a href="#tab3" data-toggle="tab">Links</a></li>
    <li><a href="#tab4" data-toggle="tab">Files</a></li>
	</ul>
  <div class="tab-content">
    <div class="tab-pane active" id="tab1">
      {% autoescape off %}
        {{ content_object.summary }}
      {% endautoescape %}
    </div>
    <div class="tab-pane" id="tab2">
      <div class="row-fluid" id="links"> <!-- Div for links -->
          {% load my_filters %}
      <!-- This is thr table for link -->
          <table id="videoTable" class="table video-table">
              <thead>
                  <tr class="video-row head-row">
                      <th data-sorter="false"> </th>
                      <th>Video</th>
                      <th>Created By</th>
                      <th>Votes</th>
                      <th data-sorter="false">Options</th>
                      <th style="display:none;">Is Stickied</th>
                  </tr>
              </thead>
              <tbody>
                  {% for video in content_object.videos.all %}
                  
                  
                  <tr id="row-video-{{ video.id }}">
                      <td style="vertical-align:middle">
                          {% if atom_object %}
                          {% include "rating/vote_arrows.html" with item='video' id=video.id atom_id=atom_object.id %}
                          {% endif %}
                      </td>
                      
                      <td style="text-align:center">
                          
                          <div id="title">
                              <strong>
                                  <div class="name-video-{{ video.id }}">
                                      {{ video.title }}
                                      {% if class_object in link.classes_stickied_in.all %}
                                      [stickied]
                                      {% endif %}
                                  </div>
                              </strong>
                          </div>
                          <div id="link">
                              <a href="#" data-sid="{{ video.id }}" data-vid="{{ video.video_id }}"><img style="margin-bottom: 5px;" class="view-video" src="https://img.youtube.com/vi/{{ video.video_id }}/default.jpg" width="120" alt="link Thumbnail" /></a>
                          </div>
                      </td>
                      
                      <td>
                          {{ video.content.owner }}
                      </td>
                      <!-- Votes -->
                      <td style="width:75px">
                          <div id="votes-sum-video-{{ video.id }}" style="text-align: center">
                                  {% if atom_object %}
                                  {{ video.vote_set|total:atom_object }}
                                  {% else %}
                                  {{ video.vote_set|total }}
                                  {% endif %}
                          </div>
                    </td>
                      <!-- end Votes -->
                      <td>
                          <!-- Button to trigger modal -->
                          <a rel="tooltip" class="icon-flag" href="#myModalvideo{{video.id}}" data-toggle="modal" title="Report"></a>
                          
                          {% include "web/home/shared/sticky.html" with type='video' object=video %}
                          {% if user.is_superuser or link.owner == user %}
                          <a rel="tooltip" class="icon-edit" href="{% url "submit_content" video.id %}?next={{request.path}}" title="Edit"></a>
                          <a rel="tooltip" class="icon-remove" href="#deleteModal-link-{{ video.id }}" data-toggle="modal" title="Delete"></a>
                          {# We only need to include this modal if the user is allowed to delete #}
                          {% include "web/home/shared/delete_modal.html" with type='link' object=link %}
                          {% endif %}
                      </td>
                      <td style="display:none;">
                          <div class="stickied-video-{{ video.id }}">
                              {% if class_object in video.classes_stickied_in.all %}
                              1
                              {% else %}
                              0
                              {% endif %}
                          </div>
                      </td>
                  </tr>
                  <!-- Modal -->
                  
                  <!--End of Modal-->
                  {% endfor %}
              </tbody>
          </table>
    <!-- End of link Table -->
      </div> <!-- end .row-fluid #links -->
    </div>
    <div class="tab-pane" id="tab3">
      <div id="links">
          <!-- This is thr table for link -->
          <table id="linkTable" class="table link-table">
              <thead>
                  <tr class="link-row head-row">
                      <th data-sorter="false"> </th>
                      <th>Name</th>
                      <th>Created By</th>
                      <th>Votes</th>
                      <th data-sorter="false">Options</th>
                      <th style="display:none;">Is Stickied</th>
                  </tr>
              </thead>
              <tbody>
                  {% for link in content_object.links.all %}
                  
                  
                  <tr id="row-link-{{ link.id }}">
                      <td style="vertical-align:middle">
                          {% if atom_object %}
                          {% include "rating/vote_arrows.html" with item='link' id=link.id atom_id=atom_object.id %}
                          {% endif %}
                      </td>
                      
                      <td>
                          {% autoescape off %}
                          <a target="_blank" href="{{ link.link }}"><p>{{ link.title }}</p></a>
                          {% endautoescape %}
                      </td>
                      <td>
                          {{ link.content.owner }}
                      </td>
                      <!-- Votes -->
                      <td style="width:75px">
                          <div id="votes-sum-link-{{ link.id }}" style="text-align: center">
                              {% if atom_object %}
                              {{ link.vote_set|total:atom_object }}
                              {% else %}
                              {{ link.vote_set|total }}
                              {% endif %}
                          </div>
                      </td>
                      <!-- end Votes -->
                      <td>
                          <!-- Button to trigger modal -->
                          <a rel="tooltip" class="icon-flag" href="#myModallink{{link.id}}" data-toggle="modal" title="Report"></a>
                          
                          {% include "web/home/shared/sticky.html" with type='link' object=link %}
                          {% if user.is_superuser or link.owner == user %}
                          <a rel="tooltip" class="icon-edit" href="{% url "submit_content" link.id %}?next={{request.path}}" title="Edit"></a>
                          <a rel="tooltip" class="icon-remove" href="#deleteModal-link-{{ link.id }}" data-toggle="modal" title="Delete"></a>
                          {# We only need to include this modal if the user is allowed to delete #}
                          {% include "web/home/shared/delete_modal.html" with type='link' object=link %}
                          {% endif %}
                      </td>
                      <td style="display:none;">
                          <div class="stickied-link-{{ link.id }}">
                              {% if class_object in link.classes_stickied_in.all %}
                              1
                              {% else %}
                              0
                              {% endif %}
                          </div>
                      </td>
                  </tr>
                  <!-- Modal -->
                  
                  <!--End of Modal-->
                  {% endfor %}
              </tbody>
          </table>

      </div>
    </div>
    <div class="tab-pane" id="tab4">
      <div id="files">
          <table id="fileTable" class="table file-table">
              <thead>
                  <tr class="file-row head-row">
                      <th data-sorter="false"> </th>
                      <th>Name</th>
                      <th>Created By</th>
                      <th>Votes</th>
                      <th data-sorter="false">Options</th>
                      <th style="display:none;">Is Stickied</th>
                  </tr>
              </thead>
              <tbody>
                  {% for file in content_object.files.all %}
                  
                  
                  <tr id="row-file-{{ file.id }}">
                      <td style="vertical-align:middle">
                          {% if atom_object %}
                          {% include "rating/vote_arrows.html" with item='file' id=file.id atom_id=atom_object.id %}
                          {% endif %}
                      </td>
                      
                      <td>
                          {% autoescape off %}
                          <p>{{ file.title }}</p>
                          {% endautoescape %}
                      </td>
                      <td>
                          {{ file.content.owner }}
                      </td>
                      <!-- Votes -->
                      <td style="width:75px">
                          <div id="votes-sum-file-{{ file.id }}" style="text-align: center">
                              {% if atom_object %}
                              {{ file.vote_set|total:atom_object }}
                              {% else %}
                              {{ file.vote_set|total }}
                              {% endif %}
                          </div>
                      </td>
                      <!-- end Votes -->
                      <td>
                          <!-- Button to trigger modal -->
                          <a rel="tooltip" class="icon-flag" href="#myModalfile{{file.id}}" data-toggle="modal" title="Report"></a>
                          
                          {% include "web/home/shared/sticky.html" with type='file' object=file %}
                          {% if user.is_superuser or link.owner == user %}
                          <a rel="tooltip" class="icon-edit" href="{% url "submit_content" file.id %}?next={{request.path}}" title="Edit"></a>
                          <a rel="tooltip" class="icon-remove" href="#deleteModal-link-{{ file.id }}" data-toggle="modal" title="Delete"></a>
                          {# We only need to include this modal if the user is allowed to delete #}
                          {% include "web/home/shared/delete_modal.html" with type='link' object=link %}
                          {% endif %}
                      </td>
                      <td style="display:none;">
                          <div class="stickied-file-{{ file.id }}">
                              {% if class_object in link.classes_stickied_in.all %}
                              1
                              {% else %}
                              0
                              {% endif %}
                          </div>
                      </td>
                  </tr>
                  <!-- Modal -->
                  
                  <!--End of Modal-->
                  {% endfor %}
              </tbody>
          </table>

        
      </div>
    </div>
  </div>
</div>
<div id="disqus_thread"></div>
<script type="text/javascript">
    
    $(document).ready(function() {
                      var oTable = $('#videoTable').dataTable( {
                                                              "sDom": '<"top"lf>rt<"bottom"p><"clear">'
                                                              });
                      var oTable = $('#linkTable').dataTable( {
                                                              "sDom": '<"top"lf>rt<"bottom"p><"clear">'
                                                              });
                      var oTable = $('#fileTable').dataTable( {
                                                             "sDom": '<"top"lf>rt<"bottom"p><"clear">'
                                                             });
                      });
    
    $('.view-video').each(function() {
                          $(this).click(function(e) {
                                        e.preventDefault();
                                        var sid = $(this).parent().attr('data-sid');
                                        var vid = $(this).parent().attr('data-vid');
                                        var params = { allowScriptAccess: 'always' };
                                        var atts = { id: "modal_player", 'wmode': 'opaque' };
                                        $('#video_player_' + sid).remove();
                                        video_preview_div = '<div id="video_preview_div_' + sid + '">Loading...</div><hr />';
                                        $('#global_modal .modal-body').empty().append(video_preview_div);
                                        swfobject.embedSWF("http://www.youtube.com/v/" + vid +
                                                           "?version=3&enablejsapi=1&playerapiid=player1", "video_preview_div_" +
                                                           sid, "560", "315", "9", null, null, params, atts
                                                           );
                                        $('#global_modal').modal().css({
                                                                       'margin-top': function () {
                                                                       return -($(this).height() / 2);
                                                                       },
                                                                       width:'auto',
                                                                       'margin-left':function(){
                                                                       return -($(this).width()/2);
                                                                       }
                                                                       });
                                        $('#global_modal').modal('show');
                                        $('#global_modal').on('hidden', function () {
                                                              $('#global_modal .modal-body').empty();
                                                              });
                                        });
                          });
    
    
    /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
    var disqus_shortname = 'cportalnt'; // required: replace example with your forum shortname
    var disqus_url = 'cportal-nt.eecs.umich.edu/content/{{ content_object.pk }}//';
    var disqus_identifier = 'content-details-{{ content_object.pk }}';

    /* * * DON'T EDIT BELOW THIS LINE * * */
    (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>

{% endblock content %}

{% block javascript %}
{{ block.super }}
<script>

  
  {% comment %}
  /**
   * When the link image is clicked open up $('div#global_modal') defined in 
   * ``knoatom/base.html``.  It deletes the contents of the body, then embeds
   * the youtube player into the body, centers the modal, and shows it.  Then 
   * when it is hidden it deletes the contents of the body again.
   */
  {% endcomment %}

</script>
{% endblock javascript %}